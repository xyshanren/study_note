<!--
 * @Autor: 李逍遥
 * @Date: 2021-03-02 08:48:20
 * @LastEditors: 李逍遥
 * @LastEditTime: 2021-03-21 22:21:13
 * @Descriptiong: 
-->

# 目录 #

- [目录](#目录)
- [更新yum源](#更新yum源)
  - [Centos7中](#centos7中)
    - [对CentOS-Base.repo进行备份](#对centos-baserepo进行备份)
    - [使用阿里云源替换本地源](#使用阿里云源替换本地源)
    - [清除yum缓存并更新](#清除yum缓存并更新)
- [设置主机名](#设置主机名)
  - [centos6下修改hostname](#centos6下修改hostname)
  - [centos7下修改hostname](#centos7下修改hostname)
  - [设置了主机名和静态ip的hosts配置](#设置了主机名和静态ip的hosts配置)
  - [网络设置](#网络设置)
- [SSH免密登录远程主机](#ssh免密登录远程主机)
  - [准备](#准备)
  - [生成秘钥](#生成秘钥)
  - [配置服务器端](#配置服务器端)
    - [上传公钥](#上传公钥)
    - [登记公钥](#登记公钥)
  - [使用ssh config管理ssh连接](#使用ssh-config管理ssh连接)

# 更新yum源 #

## Centos7中 ##

### 对CentOS-Base.repo进行备份 ###

```shell
cd /etc/yum.repos.d
cp CentOS-Base.repo CentOS-Base.repo.bak
```

### 使用阿里云源替换本地源 ###

```shell
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
```

### 清除yum缓存并更新 ###

```shell
yum makecache
yum -y update
```

# 设置主机名 #

## centos6下修改hostname ##

```shell
[root@localhost ~]$ hostname                               # 查看当前的hostnmae
localhost.localdomain
[root@localhost ~]$ vim /etc/sysconfig/network             # 编辑network文件修改hostname行（重启生效）
[root@localhost ~]$ cat /etc/sysconfig/network             # 检查修改
NETWORKING=yes
HOSTNAME=db01
[root@localhost ~]$ hostname db01                          # 设置当前的hostname(立即生效）
[root@localhost ~]$ vim /etc/hosts                         # 编辑hosts文件，给127.0.0.1添加hostname
[root@localhost ~]$ cat /etc/hosts                         # 检查
127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 db01
::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
```

## centos7下修改hostname ##

```shell
[root@localhost ~]$ hostnamectl set-hostname db01             # 使用这个命令会立即生效且重启也生效
[root@localhost ~]$ hostname                                  # 查看下
db01
[root@localhost ~]$ vim /etc/hosts                            # 编辑下hosts文件， 给127.0.0.1添加hostname
[root@localhost ~]$ cat /etc/hosts                            # 检查
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 db01
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
```

## 设置了主机名和静态ip的hosts配置 ##

```shell
vim /etc/hosts
# 去掉默认的配置，只保留以下配置
127.0.0.1 localhost 主机名
ip 主机名
```

## 网络设置 ##

```shell
# 查看ip地址
ip addr
# 查看网卡情况和ip
ifconfig
# 如果上面的命令找不到，需要安装
yum install net-tools
```

# SSH免密登录远程主机 #

>可以配合Windows中的Linux子系统使用。  

## 准备 ##

|Client|Server|
|:-|:-|
|ssh命令|sshd daemon(服务)|
|key(秘钥对)|authorized_keys(客户端的公钥进行注册)|

ssh相关安装包：  
1.openssh-server --> sshd  
2.openssh-client --> ssh  
3.openss ----------> ssh-keygen(生成秘钥)  

- 检查ssh相关软件包的安装情况  
  `yum list installed | grep ssh`  
- 检查是否启动了ssd进程  
  `ps -ef | grep sshd`  

## 生成秘钥 ##

```shell
# 使用以下命令，在 ~/.ssh 下生成秘钥对，可以在询问时指定文件名和私钥密码
[root@db01 ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:keN0Y5HIQdReImuKng9ie4XRrFu7YzhwU52tPUB6Bf8 root@db01
The key's randomart image is:
+---[RSA 2048]----+
|       +==..     |
|        =o=..    |

|     o +=B=o     |
|    . =oB=oo     |
|     * +S+  E    |
|  . * + . o      |
|  o+.B .   .     |
| . oB.+          |
|  .. +oo         |
+----[SHA256]-----+
[root@db01 ~]#

# 使用下面的命令在本地(默认在~/.ssh目录)生成无密码的秘钥对，或者使用 -f 参数指定生成目录
ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa
```

>首次使用ssh命令会生成 ~/.ssh 目录

## 配置服务器端 ##

### 上传公钥 ###

使用命令 `ssh ~/.ssh/id_rsa.pub root@ip:~` 将公钥上传到服务器用户目录。  

### 登记公钥 ###

将用户的公钥添加到 ~/.ssh/authorized_keys 中。  

```shell
# 如果没有需要先生成 authorized_keys
touch ~/.ssh/authorized_keys
# 登记公钥(追加)
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
# 设置权限
chmod 600 ~/.ssh/authorized_keys
```

## 使用ssh config管理ssh连接 ##

在本地 ~/.ssh/ 下创建 config文件，并以如下格式编辑配置文件：  

```config
Host db01
    HostName 192.168.1.112
    User root
    IdentityFile ~/.ssh/id_rsa

Host *
    ServerAliveInterval 60
    ServerAliveCountMax 20
```

- **Host**  
  别名，比如这里的是 db01, 那么使用ssh命令时只需要写 `ssh db01` 就可以了  
- **HostName**  
  目标主机的地址  
- **Port**  
  端口号  
- **User**  
  用户名  
- **IdentifyFile**  
  私钥地址  

*注意： config 和 id_rsa 需要 600 权限。*  
