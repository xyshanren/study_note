<!--
 * @Autor: 李逍遥
 * @Date: 2021-03-02 08:48:20
 * @LastEditors: 李逍遥
 * @LastEditTime: 2021-04-05 23:19:06
 * @Descriptiong: 
-->

# 目录 #

- [目录](#目录)
- [Linux基础](#linux基础)
  - [命令行入门](#命令行入门)
    - [系统常用命令](#系统常用命令)
    - [文本命令](#文本命令)
    - [文本编辑器-nano](#文本编辑器-nano)
    - [服务管理命令](#服务管理命令)
    - [作业和进程](#作业和进程)
    - [磁盘](#磁盘)
    - [Shell](#shell)
    - [netcat](#netcat)
    - [用户和用户组](#用户和用户组)
  - [目录和权限](#目录和权限)
    - [目录结构](#目录结构)
    - [Linux文件类型](#linux文件类型)
    - [文件的权限](#文件的权限)
    - [挂载外设](#挂载外设)
- [拓展](#拓展)
  - [更新yum源](#更新yum源)
    - [介绍](#介绍)
    - [对CentOS-Base.repo进行备份](#对centos-baserepo进行备份)
    - [使用阿里云源替换本地源](#使用阿里云源替换本地源)
    - [清除yum缓存并更新](#清除yum缓存并更新)
  - [设置主机名](#设置主机名)
    - [centos6下修改hostname](#centos6下修改hostname)
    - [centos7下修改hostname](#centos7下修改hostname)
    - [配置主机名和ip地址的映射](#配置主机名和ip地址的映射)
  - [SSH免密登录远程主机](#ssh免密登录远程主机)
    - [准备](#准备)
    - [生成秘钥](#生成秘钥)
    - [上传公钥到远程主机](#上传公钥到远程主机)
    - [在远程主机中登记公钥](#在远程主机中登记公钥)
    - [本地使用ssh config管理ssh连接](#本地使用ssh-config管理ssh连接)

# Linux基础 #

## 命令行入门 ##

### 系统常用命令 ###

```shell
# 查看目录和文件
ls
ls -a //显示隐藏文件和目录
ls -al
ls -l
ls -l -h
# -R 是递归显示
ls -R

# 查看帮助
ls -h
ls --help

# 查看指定命令
man command
# 查看os内置命令
help
# 查看指定命令
info command

# 清屏
clear

# 显示当前路径
pwd

# 切换目录
cd ~

# 显示当前用户
whoami

# 查看命令的文件路径
which echo

# 切换用户
su user
# 临时借用root权限执行命令
sudo command

# 为用户增加管理员权限
visudo
# 或者修改sudoers文件
vim /etc/sudoers
# 找到 root ALL=(ALL) ALL 这行(应该在100行，可以使用```:98```命令直接跳转到100行)
# 然后在这行下面增加一行内容 hadoop ALL=(ALL) ALL（其中的间隔符使用tab），然后保存修改；
hadoop ALL=(ALL) ALL

# 修改用户密码（不指定用户就是修改当前用户）
passwd [user]

# 查看ip地址
ip addr
# 查看网卡情况和ip
ifconfig
# 如果上面的命令找不到，需要安装
yum install net-tools

# 查看网络连接情况
ping localhost

# 创建目录
mkdir xx

# 查看所有命令的别名
alias

# 复制文件
cp file1 file2
# 移动文件到a目录
mv file1 /a/
# 修改文件名
mv file1 file2
# 删除文件或目录
rm

# 查看主机名
hostname

# 查看系统内核
uname -r
uname --help

# 查看文件类型
file a.txt

# 文件压缩或解压缩，文件原地压缩或解压缩（覆盖源文件）
# -d 解压，-r 递归操作目录下的文件
gzip a.txt
gzip -d a.txt
# 解压缩，等价于 gzip -d
gunzip a.txt.gz

# 归档，解归档
# 创建归档文件
tar -cvf my.tar a.txt
# 解归档
tar -xvf my.tar

# 管道符"|"，前方命令的输出作为后方命令的输入
find . | more

# 递归查找文件
find / | grep xxx
# 查找含有ibm串的文件
find . | xargs grep -ri "IBM"

# 将多行结果一行显示，使用空格替换回车换行符
find . | xargs
find . | grep txt | cp `xargs` temp

# `` 反引号，命令解析，无法嵌套
echo `cat a.txt`
echo `hostname`
# 将要ping的地址记录在文件里
ping `cat a.txt`
# 等价于反引号，支持嵌套
$(command)
$(xxx $(xxx))

# 取出指定地址的上级目录
# 输出 /home/a/b
dirname /home/a/b/c
# 取出指定路径的当前目录
# 输出 c
basename /home/a/b/c

# 关机重启命令，以下几个都可以通过参数相互实现
# 重启
reboot
# 停止系统（黑屏，未关机）
halt
# 关机
poweroff
# 关机
shutdown

halt -p == poweroff
halt - r == reboot
```

### 文本命令 ###

```shell
# 创建文件
touch file

# 重定向输出(覆盖)
echo hellowrold > file
# 重定向输出(追加模式)
echo hellowrold >> file

# 查看文件内容
cat filename
# 复制文件内容
cat file1 > file2

# 分屏显示，h显示帮助，空格翻页，q退出
more a.txt
# 查看more命令的使用帮助
man more

# 显示文件最后10行的内容，也可以加参数
tail a.txt
# 显示前10行，也可以加参数
head a.txt

# 文本统计，统计单词数、字节数、行数等，具体参数见帮助
wc a.txt
wc -c a.txt
wc -clw a.txt

# 剪切显示文件的每一行
# 从第一个字符开始，下标从1开始
cut -c 1-3 a.txt
# cut的管道应用
ps -ef | cut -c 45-90 | more
```

### 文本编辑器-nano ###

```txt
打开nano编辑器，编辑a.txt文件
nano a.txt
[Ctrl]-G : 取得在线帮助。
[Ctrl]-X : 离开nano软件，若有修改过文件会提示是否需要保存。
[Ctrl]-O :保存文件。
[Ctrl]-R :从其他文件读取数据，可以将某个文件的内容贴在本文件中。
[Ctrl]-W :查询字符串，这个也是很有帮助的命令。
[Ctrl]-C :说明目前光标所在处的行数与列数等信息。
[Ctrl]-_ :可以直接输入行号，让光标快速移动到该行。
[Alt]-Y :校正语法功能开启或关闭（单击开，再单击关闭）。
[Alt]-M :可以支持鼠标来移动光标的功能。
...
```

### 服务管理命令 ###

```shell
# 1.sys-v管理
# 查看服务的状态
service server_name status
service network status
# 开启服务
service network start
# 关闭服务
service network stop
# 重启服务
service network restart

# 2.systemd管理
```

### 作业和进程 ###

```shell
# 将程序放到后台运行，以 & 结尾
nano a.txt &
# 查看后台运行的作业数
jobs
# 切换后台作业到前台运行，1为jobs序号
fg %1
# 让后台作业运行
bg %1
# 杀死作业
kill %1

# 查看所有进程
ps -ef
ps -ef | grep net
# 动态显示进程信息，含有cpu，内存使用情况
top #q退出界面

# 查看端口占用情况
# a 所有socket，n 显示数字地址，p pid，o timer
netstat -anop
```

### 磁盘 ###

```shell
# 查看分区表
fdisk -l /dev/sda

# 查看磁盘使用情况
df
df -h
df -ah
# 查看本磁盘分区的使用情况
df -h .
```

### Shell ###

>详细语法可参考 shell编程

- 脚本中首行为标记行  
  `#!/bin/bash`  

- 变量  

  ```shell
  # 访问（环境）变量
  echo $PATH
  echo ${PATH}
  echo "$PATH"
  echo '$PATH' # 原样输出

  # 定义变量，只在session中有效
  export name=${PATH}:tom
  export name=${Var1:-${Var2}} # 三元运算，Var1没有则为Var2
  ```

- 命令执行情况  

  ```txt
  $?        命令的返回值储存的变量，0表示成功，1表示失败
  $#        参数的个数
  $1        第几个参数
  $0        当前脚本（命令）名称
  $@        取出所有参数
  shift     参数左移
  ${a/b/c}  参数
  ```

- if  
  语法：  
  if COMMANDS; then COMMANDS; [ elif COMMANDS; then COMMANDS; ]... [ else COMMANDS; ] fi  

  ```shell
  # -lt -gt 小于，大于
  if [ $# -lt 3 ]; then echo param too less; fi
  ```

- for  
  语法：  
  for (( exp1; exp2; exp3 )); do COMMANDS; done  
  for NAME [in WORDS ... ] ; do COMMANDS; done  

  ```shell
  for (( x=0 ; x<100 ; x=$x+1 )) ; do echo $x ; done
  for x in a b c d ; do echo $x ; done

  # 双循环例子
  #!/bin/bash
  lines=5
  for (( x=1; x<=$lines; x=$x+1 )) ; do
  for (( y=1 ; y <= $x ; y=$y+1 )) ; do
    echo -n $y
  done ;
  echo
  done
  ```

- while  
  语法：  
  while COMMANDS; do COMMANDS; done  

### netcat ###

- 瑞士军刀  
- Netcat 或者叫 nc 是 Linux 下的一个用于调试和检查网络工具包  
- 可用于模拟tcp/udp网络通信  
- 实现端口扫描  

- 安装  
  `yum install -y nc`  

- 使用案例：在服务器-客户端架构上使用 Netcat  
  - server  
    `nc -lk 8888`  
    >-l 监听，-k 接受多个连接
  - client  
    `nc ip 8888`  
    >客户端需要指定服务网端地址

- 使用案例：传输文件  
  使用重定向（输入|输出）  
  - server  
    `nc -l 8888 > a.txt`  
  - client  
    `cat testfile | nc ip 8888`  
    或者  
    `nc ip 8888 < testfile`  

- 端口扫描（待验证）  
  `nc ip -z port1-portn` 指定需要扫描的主机ip和端口区间  
  `nc -v -w 2 s1 -z 2000-4000` -v 详细信息，-w 连接超时，-z 端口扫描  

### 用户和用户组 ###

- 用户和用户组之间，一个用户可以属于多个组，但要有一个首要组。  

- 创建用户： `adduser` =  `useradd`  
  `adduser` 是 `useradd` 的符号连接。

  ```shell
  # 创建用户，并创建用户目录
  useradd -m user1
  # 修改密码
  passwd user1
  # 删除用户
  userdel -r user1
  ```

## 目录和权限 ##

### 目录结构 ###

与Windows的物理盘符不同，Linux的文件系统是逻辑结构。  

|目录|说明|
|:-|:-|
|`/`|文件系统的根目录|
|`/bin`|最初的（继承自Linux开源），binary文件，可执行文件|
|`/sbin`|最初的（继承自Linux开源），super binary文件，重要性更高|
|`/user/bin`|厂商相关的命令目录|
|`/user/sbin`|厂商相关的命令目录|
|`/user/local/bin`|用户级别的命令目录|
|`/user/local/sbin`|用户级别的命令目录|
|`/etc`|配置目录|
|`/mnt`|共享目录|
|`/boot`|引导目录|
|`/dev`|设备目录|
|`/lib[64]`|库目录|

### Linux文件类型 ###

  |符号|含义|
  |:-|:-|
  |`-`|文件|
  |`d`|目录|
  |`l`|链接，类似Windows的快捷方式|
  |`b`|block 块文件，比如磁盘、U盘等|
  |`c`|字符文件|

- 连接文件（符号连接）  
  - symbolic links 符号连接  
  - hard links 硬连接，两个完全相同的文件，类似实时备份，删除一个另一个还存在。  
    目录不支持硬链接。  

  ```shell
  # 创建硬连接(a.txt 是目标文件，a_link 是连接名称)
  ln a.txt a_link
  # 创建符号连接
  ln -s a.txt alk
  ln -s ~/a.txt alk

  # 针对符号连接
  # 进入物理位置
  cd -P xx
  # 显示当前目录的物理位置
  pwd -P
  ```

### 文件的权限 ###

- 从文件归属来分有以下身份：  

  ```txt
  ower(user):u
  group:g
  other:0
  ugo=all=a
  ```

- 文件或文件夹的操作权限有三种
  其中数字是使用二进制来表示权限。  

  ```txt
  read:r:4
  write:w:2
  execut:x:1

  read权限：
    文件  ：读取文件内容。
    文件夹：查看文件夹中的文件（列表）。
  write权限：
    文件  ：写入数据到文件。
    文件夹：增删文件。

  execute权限：
    文件  ：执行。
    文件夹：进入目录。
  ```

  以上文件的归属与操作权限组合成文件的权限，如下：  
  ![用户权限](images/quanx.png)

- 修改文件或目录的权限  
  只有文件的ower和root用户能修改文件的权限。  

  ```shell
  # 去除文件的用户组的写权限
  chmod g-w xxx
  # 增加文件的用户组的读写执行权限
  chmod g+rwx xxx
  # 增加文件所有用户的权限
  chmod ugo+rwx xxx
  # 使用数字修改权限(参考上图)
  chmod 644 a.txt
  # 递归修改权限
  chmod -R xxx xxx
  ```

- 修改文件或目录的owner(change owner)  

  ```shell
  chown user:user xxx
  # 递归修改文件夹和其中文件的归属
  chown -R user:user xxx
  ```

### 挂载外设 ###

`mount`  

# 拓展 #

## 更新yum源 ##

### 介绍 ###

```txt
centos
  yum Yellowdog Updater Modified，大黄

ubuntu
  apt advanced package tool，高级包管理工具

软件源：
  Repository  仓库
  url         http://xxxx
```

### 对CentOS-Base.repo进行备份 ###

```shell
cd /etc/yum.repos.d
cp CentOS-Base.repo CentOS-Base.repo.bak
```

### 使用阿里云源替换本地源 ###

```shell
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
```

### 清除yum缓存并更新 ###

```shell
yum makecache
yum -y update
```

## 设置主机名 ##

### centos6下修改hostname ###

```shell
[root@localhost ~]$ hostname                               # 查看当前的hostnmae
localhost.localdomain
[root@localhost ~]$ vim /etc/sysconfig/network             # 编辑network文件修改hostname行（重启生效）
[root@localhost ~]$ cat /etc/sysconfig/network             # 检查修改
NETWORKING=yes
HOSTNAME=db01
[root@localhost ~]$ hostname db01                          # 设置当前的hostname(立即生效）
[root@localhost ~]$ vim /etc/hosts                         # 编辑hosts文件，给127.0.0.1添加hostname
[root@localhost ~]$ cat /etc/hosts                         # 检查
127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 db01
::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
```

### centos7下修改hostname ###

```shell
# 使用这个命令会立即生效且重启也生效
[root@localhost ~]$ hostnamectl set-hostname db01
 # 查看下
[root@localhost ~]$ hostname
db01
# 编辑下hosts文件， 给127.0.0.1添加hostname
[root@localhost ~]$ vim /etc/hosts
# 检查
[root@localhost ~]$ cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 db01
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
```

### 配置主机名和ip地址的映射 ###

```shell
vim /etc/hosts
# 去掉 localhost 配置，hadoop需要ssh互信，可能会产生循环
# 127.0.0.1 localhost
ip 主机名
```

## SSH免密登录远程主机 ##

>可以配合Windows中的Linux子系统使用。  

### 准备 ###

|Client|Server|
|:-|:-|
|ssh命令|sshd daemon(服务)|
|key(秘钥对)|authorized_keys(客户端的公钥进行注册)|

ssh相关安装包：  
1.openssh-server --> sshd  
2.openssh-client --> ssh  
3.openss ----------> ssh-keygen(生成秘钥)  

- 检查ssh相关软件包的安装情况  
  `yum list installed | grep ssh`  
- 检查是否启动了ssd进程  
  `ps -ef | grep sshd`  

### 生成秘钥 ###

```shell
# 使用以下命令，在 ~/.ssh 下生成秘钥对，可以在询问时指定文件名和私钥密码
[root@db01 ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:keN0Y5HIQdReImuKng9ie4XRrFu7YzhwU52tPUB6Bf8 root@db01
The key's randomart image is:
+---[RSA 2048]----+
|       +==..     |
|        =o=..    |

|     o +=B=o     |
|    . =oB=oo     |
|     * +S+  E    |
|  . * + . o      |
|  o+.B .   .     |
| . oB.+          |
|  .. +oo         |
+----[SHA256]-----+
[root@db01 ~]#

# 使用下面的命令在本地(默认在~/.ssh目录)生成无密码的秘钥对，或者使用 -f 参数指定生成目录
ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa
```

>首次使用ssh命令会生成 ~/.ssh 目录

### 上传公钥到远程主机 ###

使用命令 `ssh ~/.ssh/id_rsa.pub root@ip:~` 将公钥上传到服务器用户目录。  

### 在远程主机中登记公钥 ###

将用户的公钥添加到 ~/.ssh/authorized_keys 中。  

```shell
# 如果没有需要先生成 authorized_keys
touch ~/.ssh/authorized_keys
# 登记公钥(追加)
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
# 设置权限
chmod 600 ~/.ssh/authorized_keys
```

>非root用户时 .ssh 需要700权限， authorized_keys 需要600权限

### 本地使用ssh config管理ssh连接 ###

在本地 ~/.ssh/ 下创建 config文件，并以如下格式编辑配置文件：  

```config
Host db01
    HostName 192.168.1.112
    User root
    IdentityFile ~/.ssh/id_rsa

Host *
    ServerAliveInterval 60
    ServerAliveCountMax 20
```

- **Host**  
  别名，比如这里的是 db01, 那么使用ssh命令时只需要写 `ssh db01` 就可以了  
- **HostName**  
  目标主机的地址  
- **Port**  
  端口号  
- **User**  
  用户名  
- **IdentifyFile**  
  私钥地址  

*注意： config 和 id_rsa 需要 600 权限。*  
